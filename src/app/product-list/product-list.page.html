<main-nav aktivPage="ProductList" 
          [idCustomer]="idCustomer"  
          [searchText]="columnFilterValues['search_all']"
          (ping)="update($event)" 
          autoDisplay="true">
</main-nav>

<div class="ek-content" (window:resize)="onResize($event)">
    <p-menubar id="menuMin" class="wideMenu">
        <div>
            <button type="button" 
                    pButton 
                    icon="fa fa-fw fa-list" 
                    label="Menu" 
                    id="btnMenu"
                    (click)="menu.toggle($event)">
                <span class="ui-submenu-icon pi pi-fw pi-caret-down slide-caret"></span>
            </button>
        </div>
        <div style="padding-top: 5px; padding-right: 10px; margin-left: auto; color: white;">
            <button type="button" 
                    pButton 
                    (click)="deSelectAll()">
                {{'selektiert' |translate }}: {{selectedRow}}
            </button>

        </div>
        <div class="ui-inputgroup search-search">
            <input type="text" 
                    pInputText 
                    placeholder="{{'Suche' |translate }}"
                    [(ngModel)]="columnFilterValues['search_all']" 
                    (input)="search_all()">
        </div>
    </p-menubar>
    <p-slideMenu [model]="menuItems" 
                 popup="false" 
                 [viewportHeight]="280" 
                 [style]="{'width':'200px'}"
                  #menu>
    </p-slideMenu>
    <p-menubar [model]="menuItems" 
               [autoDisplay]="false" 
               id="menuMax">
        <div style="padding-top: 5px; padding-right: 10px; color: white;">
            <button type="button" pButton (click)="deSelectAll()">
                {{'selektiert' |translate }}: {{selectedRow}}
            </button>
        </div>
        <div class="ui-inputgroup search-search">
            <input type="text" 
                   pInputText 
                   placeholder="{{'Suche' |translate }}"
                   [(ngModel)]="columnFilterValues['search_all']" 
                   (input)="search_all()">
        </div>
    </p-menubar>

    <div id="heightCalc" 
         class="heightCalc" 
         #divHeightCalc>
    </div>
    <p-treeTable [value]="productListView" 
                 [columns]="selectedColumns" 
                 selectionMode="single"
                 [(selection)]="selectedNode" 
                 (onNodeSelect)="nodeSelect($event, selectedNode)"
                 (onNodeUnselect)="onNodeUnselect($event, selectedNode)" 
                 dataKey="id" 
                 (onNodeExpand)="onNodeExpand($event)"
                 (onNodeCollapse)="onNodeCollapse($event)" 
                 styleClass="ui-treetable-scrollable-body" 
                 [resizableColumns]="true"
                 [scrollable]="true" 
                 [paginator]="false" 
                 [rows]="rowCount" 
                 [scrollHeight]="heightCalc"
                 [virtualRowHeight]="rowHeight" 
                 [virtualScroll]="true" 
                 [lazy]="true" 
                 (onLazyLoad)="loadNodes($event)"
                 [loading]="false" 
                 [totalRecords]="rowRecords"
                 [reorderableColumns]="true" 
                 (onColReorder)="onColReorder($event)"
                 (onColResize)="onColResize($event)" 
                 [sortField]="sortedColumn['sort_field']"
                 [sortOrder]="sortedColumn['sort_order']">
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th > </th>  
                <th *ngFor="let col of selectedColumns.slice(1);" 
                    ttResizableColumn 
                    [ttSortableColumn]="col.field"
                    ttReorderableColumn > {{col.header}}
                    <p-treeTableSortIcon [field]="col.field">
                    </p-treeTableSortIcon>
                </th>
            </tr>
            <tr [hidden]="!splitFilter">
                    <th *ngFor="let col of selectedColumns; let i = index" 
                    nowrap 
                    [ngSwitch]="col.field" 
                    class="p-table-filter">
                    <input pInputText 
                           type="text" 
                           class="filter-search" 
                           (input)="search_all()"
                           *ngIf="i != 0"
                        [(ngModel)]="columnFilterValues[col.field]">
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" 
                    let-rowNode 
                    let-rowData="rowData" 
                    let-columns="columns">
            <tr [ttSelectableRow]="rowNode">
                <td>     
                    <div class="workWidthfix">
                        <ion-button [hidden]="!deleteMode" class="btn btn-danger" size="small"  (click)="productDeactivateAlert(rowNode)">
                            <ion-icon name="trash"></ion-icon>
                        </ion-button>
                        <ion-button [hidden]="!editMode" class="btn btn-success" size="small"  (click)="editProduct(rowData)">
                                <ion-icon name="create"></ion-icon>
                        </ion-button>
                        <ion-button [hidden]="workMode"  class="btn btn-primary" size="small"  (click)="viewProduct(rowData)">
                            <ion-icon name="eye"></ion-icon> 
                        </ion-button>          
                    </div>               
                </td>
                <td *ngFor="let col of selectedColumns.slice(1); let i = index" [ngStyle]="showActivePassiveProduct && {'color': '#ccc'}">
                    <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>

                    <span *ngIf="col.field == 'nfc_tag_id'">
                        <span>
                            <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
                            <ion-icon name="wifi" *ngIf="rowData[col.field]"  [ngStyle]="{'color':'rgb(0, 157, 224)'}">
                            </ion-icon>
                        </span>
                    </span>
                    <span *ngIf="col.field != 'nfc_tag_id'">{{rowData[col.field]}}</span>

                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height:34px">
                <td *ngFor="let col of selectedColumns;">
                    <div class="loading-text"></div>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
    
    
</div>

<ion-fab [hidden]="!workMode" vertical="bottom" horizontal="end" slot="fixed" class="liftiball liftiball-cancel">
    <!-- BUTTON -->
    <ion-fab-button color="danger" title="{{'abbrechen' | translate}}" (click)="work_mode(0);">
        <i class="fas fa-times"></i>
    </ion-fab-button>
</ion-fab>

<ion-fab [hidden]="workMode" vertical="bottom" horizontal="end" slot="fixed" class="liftiball" #fab1>
    <ion-fab-button color="tertiary" (click)="fabClick(1)" >
        <ion-icon name="menu"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Neues Produkt' | translate}}" (click)="menu_new()" *ngIf="userdata.role_set.edit_products">
            <i class="fas fa-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Neues Protokoll' | translate}}"  *ngIf="userdata.role_set.check_products">
            <i class="fas fa-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Neue Produktvorlage' | translate}}" *ngIf="userdata.role_set.edit_product_templates">
            <i class="fas fa-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Bearbeiten' | translate}}" (click)="work_mode(1)" *ngIf="userdata.role_set.edit_products">
            <i class="fas fa-pen"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="danger" title="{{'Löschen' | translate}}" (click)="work_mode(2)"  *ngIf="userdata.role_set.edit_products">
            <i class="fas fa-trash"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" title="{{'Bewegen' | translate}}" *ngIf="userdata.role_set.edit_products">
            <i class="fas fa-arrows-alt"></i>
        </ion-fab-button>

        
    </ion-fab-list>
</ion-fab>

<ion-fab [hidden]="workMode" vertical="bottom" horizontal="end" slot="fixed" class="liftiball liftiball-extra" #fab2>
    <ion-fab-button color="medium" (click)="fabClick(2)" >
        <ion-icon name="settings"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
        <!-- BUTTON -->
        <ion-fab-button color="medium" title="{{'Spalten' | translate}}" (click)="show_columns()">
            <i class="fas fa-columns"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="medium" title="{{'Filter zurücksetzen' | translate}}" (click)="cancel_filters(2)">
            <i class="fas fa-filter"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="warning" title="{{'PDF Export' | translate}}" (click)="pdf_export()">
            <i class="fas fa-file-download"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="warning" title="{{'XLS Export' | translate}}" (click)="excel_export()">
            <i class="fas fa-file-download"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Produktmigration' | translate}}" (click)="product_migration()" *ngIf="(selectedRow==1)&& userdata.role_set.edit_products">
            <i class="fas fa-angle-double-right"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="success" title="{{'Produkt kopieren' | translate}}" (click)="product_copy()" *ngIf="(selectedRow==1)&& userdata.role_set.edit_products">
            <i class="fas fa-clone"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="dark" title="{{'Protokollverlauf' | translate}}" (click)="menu_history()" *ngIf="selectedRow==1">
            <i class="fas fa-info"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="dark" title="{{'zeige Basisinformationen' | translate}}" *ngIf="!showBasicInfo" (click)="lengthOfBasis()" >
            <i class="fas fa-info"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="dark" title="{{'Basisinformationen ausblenden' | translate}}" *ngIf="showBasicInfo" (click)="showBasicInfo = false;">
            <i class="fas fa-info"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="dark" title="{{'zeige nur passive Produkte' | translate}}" *ngIf="!showActivePassiveProduct" (click)="activePassiveProduct()">
            <i class="fab fa-searchengin"></i>
        </ion-fab-button>
        <ion-fab-button color="dark" title="{{'zeige nur aktive Produkte' | translate}}" *ngIf="showActivePassiveProduct" (click)="activePassiveProduct()">
            <i class="fab fa-searchengin"></i>
        </ion-fab-button>
    </ion-fab-list>
</ion-fab>

<bottom-nav></bottom-nav>