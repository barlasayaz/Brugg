<main-nav aktivPage="ProductList" [idCustomer]="idCustomer" autoDisplay="true"></main-nav>

<div class="ek-content" (window:resize)="onResize($event)">
    <p-menubar id="menuMin" class="wideMenu">
        <div>
            <button type="button" 
                    pButton 
                    icon="fa fa-fw fa-list" 
                    label="Menu" 
                    id="btnMenu"
                    (click)="menu.toggle($event)">
                <span class="ui-submenu-icon pi pi-fw pi-caret-down slide-caret"></span>
            </button>
        </div>
        <div style="padding-top: 5px; padding-right: 10px; margin-left: auto; color: white;">
            <button type="button" 
                    pButton 
                    (click)="deSelectAll()">
                {{'selektiert' |translate }}: {{selectedRow}}
            </button>

        </div>
        <div class="ui-inputgroup search-search">
            <input type="text" 
                    pInputText 
                    placeholder="{{'Suche' |translate }}"
                    [(ngModel)]="columnFilterValues['search_all']" 
                    (input)="search_all()">
        </div>
    </p-menubar>
    <p-slideMenu [model]="menuItems" 
                 popup="false" 
                 [viewportHeight]="280" 
                 [style]="{'width':'200px'}"
                  #menu>
    </p-slideMenu>
    <p-menubar [model]="menuItems" 
               [autoDisplay]="false" 
               id="menuMax">
        <div style="padding-top: 5px; padding-right: 10px; color: white;">
            <button type="button" pButton (click)="deSelectAll()">
                {{'selektiert' |translate }}: {{selectedRow}}
            </button>
        </div>
        <div class="ui-inputgroup search-search">
            <input type="text" 
                   pInputText 
                   placeholder="{{'Suche' |translate }}"
                   [(ngModel)]="columnFilterValues['search_all']" 
                   (input)="search_all()">
            <!-- <button (click)="search_all()" 
                    pButton type="button" 
                    icon="fa fa-search" 
                    class="ui-button-warn">
            </button>       -->
        </div>
    </p-menubar>

    <div id="heightCalc" 
         class="heightCalc" 
         #divHeightCalc>
    </div>
    <p-treeTable *ngIf="selectMode&&!editMode" 
                 [value]="productListView" 
                 [columns]="selectedColumns" 
                 selectionMode="single"
                 [(selection)]="selectedNode" 
                 (onNodeSelect)="nodeSelect($event, selectedNode)"
                 (onNodeUnselect)="onNodeUnselect($event, selectedNode)" 
                 dataKey="id" 
                 (onNodeExpand)="onNodeExpand($event)"
                 (onNodeCollapse)="onNodeCollapse($event)" 
                 styleClass="ui-treetable-scrollable-body" 
                 [resizableColumns]="true"
                 [scrollable]="true" 
                 [paginator]="false" 
                 [rows]="rowCount" 
                 [scrollHeight]="heightCalc"
                 [virtualRowHeight]="rowHeight" 
                 [virtualScroll]="true" 
                 [lazy]="true" 
                 (onLazyLoad)="loadNodes($event)"
                 [loading]="false" 
                 [totalRecords]="rowRecords"
                 [reorderableColumns]="true" 
                 (onColReorder)="onColReorder($event)"
                 (onColResize)="onColResize($event)" 
                 [sortField]="sortedColumn['sort_field']"
                 [sortOrder]="sortedColumn['sort_order']">
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of selectedColumns" 
                    ttResizableColumn 
                    [ttSortableColumn]="col.field"
                    ttReorderableColumn > {{col.header}}
                    <p-treeTableSortIcon [field]="col.field">
                    </p-treeTableSortIcon>
                </th>
            </tr>
            <tr [hidden]="!splitFilter">
                    <th *ngFor="let col of selectedColumns" 
                    nowrap 
                    [ngSwitch]="col.field" 
                    class="p-table-filter">
                    <input pInputText 
                           type="text" 
                           class="filter-search" 
                           (input)="search_all()"
                        [(ngModel)]="columnFilterValues[col.field]">
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" 
                    let-rowNode 
                    let-rowData="rowData" 
                    let-columns="columns">
            <tr [ttSelectableRow]="rowNode">
                <td *ngFor="let col of selectedColumns; let i = index" [ngStyle]="showActivePassiveProduct && {'color': '#ccc'}">
                    <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>

                    <span *ngIf="col.field == 'nfc_tag_id'">
                        <span>
                            <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
                            <ion-icon name="wifi" *ngIf="rowData[col.field]" [ngStyle]="{'color':'rgb(0, 157, 224)'}">
                            </ion-icon>
                        </span>
                    </span>
                    <span *ngIf="col.field != 'nfc_tag_id'">{{rowData[col.field]}}</span>

                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height:34px">
                <td *ngFor="let col of selectedColumns;">
                    <div class="loading-text"></div>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
    <p-treeTable *ngIf="!selectMode&&!editMode"
                 [value]="productListView"
                 [columns]="selectedColumns"
                 selectionMode="multiple"
                 [(selection)]="selectedNode"
                 (onNodeSelect)="nodeSelect($event, selectedNode)"
                 (onNodeUnselect)="onNodeUnselect($event, selectedNode)"
                 dataKey="id"
                 (onNodeExpand)="onNodeExpand($event)"
                 (onNodeCollapse)="onNodeCollapse($event)"
                 styleClass="ui-treetable-scrollable-body"
                 [resizableColumns]="true"
                 [scrollable]="true"
                 [paginator]="false" 
                 [rows]="rowCount" 
                 [scrollHeight]="heightCalc"
                 [virtualRowHeight]="rowHeight"
                 [virtualScroll]="true" 
                 [lazy]="true" 
                 (onLazyLoad)="loadNodes($event)"  
                 [loading]="false" 
                 [totalRecords]="rowRecords"
                 [reorderableColumns]="true"
                 (onColReorder)="onColReorder($event)"
                 (onColResize)="onColResize($event)"
                 [sortField] = "sortedColumn['sort_field']"
                 [sortOrder] = "sortedColumn['sort_order']" >   
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of selectedColumns" 
                    ttResizableColumn
                    [ttSortableColumn]="col.field" 
                    ttReorderableColumn 
                    > {{col.header}}
                    <p-treeTableSortIcon [field]="col.field">
                    </p-treeTableSortIcon>
                </th>
                
            </tr>
            <tr [hidden]="!splitFilter">
                <th *ngFor="let col of selectedColumns" 
                    nowrap 
                    [ngSwitch]="col.field" 
                    class="p-table-filter">
                    <input pInputText 
                           type="text" 
                           class="filter-search" 
                           (input)="search_all()"
                        [(ngModel)]="columnFilterValues[col.field]">
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" 
                    let-rowIndex
                    let-rowNode
                    let-rowData="rowData" 
                    let-columns="columns"> 
            <tr [ttSelectableRow]="rowNode" >
                <td *ngFor="let col of selectedColumns; let i = index" [ngStyle]="showActivePassiveProduct && {'color': '#ccc'}">
                   <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>

                    <span *ngIf="col.field == 'nfc_tag_id'">
                        <span>
                            <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
                            <ion-icon name="wifi" *ngIf="rowData[col.field]" [ngStyle]="{'color':'rgb(0, 157, 224)'}">
                            </ion-icon>
                        </span>
                    </span>
                    <span *ngIf="(col.field != 'nfc_tag_id') && (col.field === 'last_protocol_next')"
                          [ngStyle]="!showActivePassiveProduct && {'color': rowData.last_protocol_next_color}">{{rowData[col.field]}}</span>
                    <span *ngIf="(col.field != 'nfc_tag_id') && (col.field != 'last_protocol_next')">
                        <span *ngIf="(rowData[col.field]!=='x') && (rowData[col.field]!=='√')">
                            {{rowData[col.field]}}
                        </span>
                        <span *ngIf="(rowData[col.field]==='x') || (rowData[col.field]==='√')">
                            <img *ngIf="rowData[col.field]==='√'" src="/assets/imgs/available.png" alt=""
                                height="17px" />
                            <img *ngIf="rowData[col.field]==='x'" src="/assets/imgs/not_available.png" alt=""
                                height="17px" />
                        </span>
                    </span>
                    <div *ngIf="(i===1) && showBasicInfo" style="font-size: 85%;  ">
                            {{rowData['_basic_info_show_']}}
                    </div>
                </td>
            </tr>
            <!--
            <tr >
                    <td (click)="test(rowIndex)" >{{'ffffffffffff'}} </td>
                    <td colspan="2" > {{rowData['_basic_info_']}}</td>  
                    <td [attr.colspan]="selectedColumns.length-3"></td>                 
            </tr>
            -->
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height:34px">
                <td *ngFor="let col of selectedColumns;">
                    <div class="loading-text"></div>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
    <p-treeTable *ngIf="!selectMode&&editMode"
                [value]="productListView"
                [columns]="selectedColumns"
                dataKey="id"
                (onNodeExpand)="onNodeExpand($event)"
                (onNodeCollapse)="onNodeCollapse($event)"
                styleClass="ui-treetable-scrollable-body"
                [resizableColumns]="true"
                [scrollable]="true"
                [paginator]="false" 
                [rows]="rowCount" 
                [scrollHeight]="heightCalc"
                [virtualRowHeight]="rowHeight"
                [virtualScroll]="true" 
                [lazy]="true" 
                (onLazyLoad)="loadNodes($event)"  
                [loading]="false" 
                [totalRecords]="rowRecords"
                [reorderableColumns]="true"
                (onColReorder)="onColReorder($event)"
                (onColResize)="onColResize($event)"
                [sortField] = "sortedColumn['sort_field']"
                [sortOrder] = "sortedColumn['sort_order']" 
                (onEditComplete)="onEditComplete($event)" >   
<ng-template pTemplate="colgroup" let-columns>
<colgroup>
   <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
</colgroup>
</ng-template>
<ng-template pTemplate="header" let-columns>
<tr>
   <th *ngFor="let col of selectedColumns" 
       ttResizableColumn
       [ttSortableColumn]="col.field" 
       ttReorderableColumn 
       > {{col.header}}
       <p-treeTableSortIcon [field]="col.field">
       </p-treeTableSortIcon>
   </th>
   
</tr>
<tr [hidden]="!splitFilter">
   <th *ngFor="let col of selectedColumns" 
       nowrap 
       [ngSwitch]="col.field" 
       class="p-table-filter">
       <input pInputText 
              type="text" 
              class="filter-search" 
              (input)="search_all()"
              [(ngModel)]="columnFilterValues[col.field]">
   </th>
</tr>
</ng-template>
<ng-template pTemplate="body" 
       let-rowIndex
       let-rowNode
       let-rowData="rowData" 
       let-columns="columns"> 
<tr>
   <td *ngFor="let col of selectedColumns; let i = index" 
       [ttEditableColumn]="rowData"
       [ttEditableColumnField]="col.field"
       [ngStyle]="showActivePassiveProduct && {'color': '#ccc'}">
      <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>
      <p-treeTableCellEditor>
            <ng-template pTemplate="input" *ngIf="col.editable">
                <input pInputText type="text" [(ngModel)]="rowData[col.field]"
                    [ngStyle]="{'width': i == 0 ? '90%': '100%'}">
            </ng-template>
            <ng-template pTemplate="output"
                *ngIf="(col.field != 'nfc_tag_id') && (col.field != 'last_protocol_next') && (rowData[col.field]!=='x') && (rowData[col.field]!=='√')">
                {{rowData[col.field]}}</ng-template>
        </p-treeTableCellEditor>
       <span *ngIf="col.field == 'nfc_tag_id'">
           <span>
               <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
               <ion-icon name="wifi" *ngIf="rowData[col.field]" [ngStyle]="{'color':'rgb(0, 157, 224)'}">
               </ion-icon>
           </span>
       </span>
       <span *ngIf="(col.field != 'nfc_tag_id') && (col.field === 'last_protocol_next')"
           [ngStyle]="!showActivePassiveProduct && {'color': rowData.last_protocol_next_color  }">{{rowData[col.field]}}</span>
       <span *ngIf="(col.field != 'nfc_tag_id') && (col.field != 'last_protocol_next')">
           <span *ngIf="(rowData[col.field]==='x') || (rowData[col.field]==='√')">
               <img *ngIf="rowData[col.field]==='√'" src="/assets/imgs/available.png" alt=""
                   height="17px" />
               <img *ngIf="rowData[col.field]==='x'" src="/assets/imgs/not_available.png" alt=""
                   height="17px" />
           </span>
       </span>
       <div *ngIf="i == 1" style="font-size: 85%;  ">
               {{rowData['_basic_info_']}}
       </div>
   </td>
</tr>
</ng-template>
<ng-template pTemplate="loadingbody" let-columns="columns">
<tr style="height:34px">
   <td *ngFor="let col of selectedColumns;">
       <div class="loading-text"></div>
   </td>
</tr>
</ng-template>
</p-treeTable>
</div>

<ion-fab vertical="bottom" horizontal="end" slot="fixed" class="liftiball">
    <ion-fab-button color="tertiary">
        <ion-icon name="menu"></ion-icon>
    </ion-fab-button>
    <ion-fab-list side="top">
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Ansicht">
            <i class="pi pi-eye"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Bearbeiten">
            <i class="pi pi-pencil"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Löschen">
            <i class="pi pi-trash"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Bewegen">
            <i class="pi pi-chevron-up"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Neue Produktvorlage">
            <i class="pi pi-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Neues Produkt">
            <i class="pi pi-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Neues Protokoll">
            <i class="pi pi-plus"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Spalten">
            <i class="pi pi-eject"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Filter zurücksetzen">
            <i class="pi pi-filter"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="PDF Export">
            <i class="pi pi-save"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="XLS Export">
            <i class="pi pi-save"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Produktmigration">
            <i class="pi pi-arrow-right"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Produkt kopieren">
            <i class="pi pi-copy"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Protokollverlauf">
            <i class="pi pi-info-circle"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="zeige Basisinformationen">
            <i class="pi pi-info-circle"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="Basisinformationen ausblenden">
            <i class="pi pi-info-circle"></i>
        </ion-fab-button>
        <!-- BUTTON -->
        <ion-fab-button color="primary" data-desc="zeige nur passive Produkte">
            <i class="pi pi-search"></i>
        </ion-fab-button>
    </ion-fab-list>
</ion-fab>