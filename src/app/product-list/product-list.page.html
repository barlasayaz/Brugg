<main-nav aktivPage="ProductList" [idCustomer]="idCustomer" autoDisplay="true"></main-nav>

<div class="ek-content" (window:resize)="onResize($event)">
    <p-menubar id="menuMin" class="wideMenu">
        <div>
            <button type="button" 
                    pButton
                    icon="fa fa-fw fa-list"
                    label="Menu"
                    id="btnMenu"
                    (click)="menu.toggle($event)">
                <span class="ui-submenu-icon pi pi-fw pi-caret-down slide-caret"></span>
            </button>            
        </div>
        <div style="padding-top: 5px; padding-right: 10px; margin-left: auto; color: white;">
            <button type="button" pButton (click)="deSelectAll()" >
                {{'selektiert' |translate }}: {{selectedRow}}
            </button>
 
        </div>
        <div class="ui-inputgroup search-search">            
            <input type="text" 
                   pInputText
                   placeholder="{{'Suche' |translate }}"
                   [(ngModel)]="columnFilterValues['search_all']" 
                   (input)="search_all()">
        </div>
    </p-menubar>
    <p-slideMenu [model]="menuItems"
                 popup="false"
                 [viewportHeight]="280" 
                 [style]="{'width':'200px'}" 
                 #menu>
    </p-slideMenu>
    <p-menubar [model]="menuItems"
               [autoDisplay]="false"
               id="menuMax">
        <div style="padding-top: 5px; padding-right: 10px; color: white;">
            <button type="button" pButton (click)="deSelectAll()" >
             {{'selektiert' |translate }}: {{selectedRow}}
            </button>
        </div>
        <div class="ui-inputgroup search-search">           
            <input type="text"
                   pInputText
                   placeholder="{{'Suche' |translate }}"
                   [(ngModel)]="columnFilterValues['search_all']"
                   (input)="search_all()">
            <!-- <button (click)="search_all()" 
                    pButton type="button" 
                    icon="fa fa-search" 
                    class="ui-button-warn">
            </button>       -->
        </div>
    </p-menubar>

    <div id="heightCalc" 
         class="heightCalc"
         #divHeightCalc>
    </div>    
    <p-treeTable *ngIf="selectMode"
                 [value]="productListView"
                 [columns]="selectedColumns"
                 selectionMode="single"
                 [(selection)]="selectedNode"
                 (onNodeSelect)="nodeSelect($event, selectedNode)"
                 (onNodeUnselect)="onNodeUnselect($event, selectedNode)"
                 dataKey="id"
                 (onNodeExpand)="onNodeExpand($event)"
                 (onNodeCollapse)="onNodeCollapse($event)"
                 styleClass="ui-treetable-scrollable-body"
                 [resizableColumns]="true"
                 [scrollable]="true"
                 [paginator]="false" 
                 [rows]="rowCount" 
                 [scrollHeight]="heightCalc"
                 [virtualRowHeight]="rowHeight"
                 [virtualScroll]="true" 
                 [lazy]="true" 
                 (onLazyLoad)="loadNodes($event)"  
                 [loading]="false" 
                 [totalRecords]="rowRecords"
                 [reorderableColumns]="true" 
                 (onColReorder)="onColReorder($event)"
                 (onColResize)="onColResize($event)"
                 [sortField] = "sortedColumn['sort_field']"
                 [sortOrder] = "sortedColumn['sort_order']" >   
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of selectedColumns" 
                    ttResizableColumn
                    [ttSortableColumn]="col.field" 
                    ttReorderableColumn > {{col.header}}
                    <p-treeTableSortIcon [field]="col.field">
                    </p-treeTableSortIcon>
                </th>
            </tr>
            <tr [hidden]="!splitFilter">
                <th *ngFor="let col of selectedColumns" 
                    nowrap 
                    [ngSwitch]="col.field" 
                    class="p-table-filter">
                    <input pInputText 
                           type="text" 
                           class="filter-search" 
                           (input)="search_all()"
                        [(ngModel)]="columnFilterValues[col.field]">
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" 
                    let-rowNode 
                    let-rowData="rowData" 
                    let-columns="columns">
            <tr [ttSelectableRow]="rowNode">
                <td *ngFor="let col of selectedColumns; let i = index">
                    <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>

                    <span *ngIf="col.field == 'nfc_tag_id'">
                        <span>
                            <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
                            <ion-icon name="wifi" *ngIf="rowData[col.field]" [ngStyle]="{'color':'rgb(0, 157, 224)'}">
                            </ion-icon>
                        </span>
                    </span>
                    <span *ngIf="col.field != 'nfc_tag_id'">{{rowData[col.field]}}</span>

                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height:34px">
                <td *ngFor="let col of selectedColumns;">
                    <div class="loading-text"></div>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
    <p-treeTable *ngIf="!selectMode"
                 [value]="productListView"
                 [columns]="selectedColumns"
                 selectionMode="multiple"
                 [(selection)]="selectedNode"
                 (onNodeSelect)="nodeSelect($event, selectedNode)"
                 (onNodeUnselect)="onNodeUnselect($event, selectedNode)"
                 dataKey="id"
                 (onNodeExpand)="onNodeExpand($event)"
                 (onNodeCollapse)="onNodeCollapse($event)"
                 styleClass="ui-treetable-scrollable-body"
                 [resizableColumns]="true"
                 [scrollable]="true"
                 [paginator]="false" 
                 [rows]="rowCount" 
                 [scrollHeight]="heightCalc"
                 [virtualRowHeight]="rowHeight"
                 [virtualScroll]="true" 
                 [lazy]="true" 
                 (onLazyLoad)="loadNodes($event)"  
                 [loading]="false" 
                 [totalRecords]="rowRecords"
                 [reorderableColumns]="true"
                 (onColReorder)="onColReorder($event)"
                 (onColResize)="onColResize($event)"
                 [sortField] = "sortedColumn['sort_field']"
                 [sortOrder] = "sortedColumn['sort_order']" >   
        <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
                <col *ngFor="let col of selectedColumns" [ngStyle]="{width: col.width}">
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of selectedColumns" 
                    ttResizableColumn
                    [ttSortableColumn]="col.field" 
                    ttReorderableColumn > {{col.header}}
                    <p-treeTableSortIcon [field]="col.field">
                    </p-treeTableSortIcon>
                </th>
            </tr>
            <tr [hidden]="!splitFilter">
                <th *ngFor="let col of selectedColumns" 
                    nowrap 
                    [ngSwitch]="col.field" 
                    class="p-table-filter">
                    <input pInputText 
                           type="text" 
                           class="filter-search" 
                           (input)="search_all()"
                        [(ngModel)]="columnFilterValues[col.field]">
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" 
                    let-rowNode 
                    let-rowData="rowData" 
                    let-columns="columns">
            <tr [ttSelectableRow]="rowNode">
                <td *ngFor="let col of selectedColumns; let i = index">
                   <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>

                    <span *ngIf="col.field == 'nfc_tag_id'">
                        <span>
                            <ion-icon name="wifi" *ngIf="!rowData[col.field]" [ngStyle]="{'color':'#ccc'}"></ion-icon>
                            <ion-icon name="wifi" *ngIf="rowData[col.field]" [ngStyle]="{'color':'rgb(0, 157, 224)'}">
                            </ion-icon>
                        </span>
                    </span>                    
                    <span *ngIf="(col.field != 'nfc_tag_id') && (col.field === 'last_protocol_next')" [ngStyle]="{'color': rowData.last_protocol_next_color  }" >{{rowData[col.field]}}</span>
                    <span *ngIf="(col.field != 'nfc_tag_id') && (col.field != 'last_protocol_next')">
                        <span *ngIf="(rowData[col.field]!=='Falsch') && (rowData[col.field]!=='Wahr') &&
                                     (rowData[col.field]!=='False') && (rowData[col.field]!=='True') &&
                                     (rowData[col.field]!=='Faux') && (rowData[col.field]!=='Vrai') &&
                                     (rowData[col.field]!=='Falso') && (rowData[col.field]!=='Vero')">
                            {{rowData[col.field]}}
                        </span>
                        <span *ngIf="(rowData[col.field]==='Falsch') || (rowData[col.field]==='Wahr') ||
                                     (rowData[col.field]==='False') || (rowData[col.field]==='True') ||
                                     (rowData[col.field]==='Faux') || (rowData[col.field]==='Vrai') ||
                                     (rowData[col.field]==='Falso') || (rowData[col.field]==='Vero')">                        
                                <img *ngIf="rowData[col.field]==='Wahr' ||
                                            rowData[col.field]==='True' ||
                                            rowData[col.field]==='Vrai' ||
                                            rowData[col.field]==='Vero'"
                                    src="/assets/imgs/available.jpg" alt="" height="17px"/>
                                <img *ngIf="rowData[col.field]==='Falsch' ||
                                            rowData[col.field]==='False' ||
                                            rowData[col.field]==='Faux' ||
                                            rowData[col.field]==='Falso'"
                                    src="/assets/imgs/not_available.jpg" alt="" height="17px"/>
                        </span>
                    </span>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height:34px">
                <td *ngFor="let col of selectedColumns;">
                    <div class="loading-text"></div>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
</div>